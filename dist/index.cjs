"use strict";var P=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var q=(e,t)=>{for(var n in t)P(e,n,{get:t[n],enumerable:!0})},w=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of $(t))!G.call(e,r)&&r!==n&&P(e,r,{get:()=>t[r],enumerable:!(s=z(t,r))||s.enumerable});return e},T=(e,t,n)=>(w(e,t,"default"),n&&w(n,t,"default"));var J=e=>w(P({},"__esModule",{value:!0}),e);var I={};q(I,{ADA:()=>ge,AddressD:()=>ne,AddressSchema:()=>V,AssetClassD:()=>re,AssetClassSchema:()=>v,CredentialD:()=>te,CredentialSchema:()=>A,DirectoryNodeDatum:()=>ae,DirectoryNodeDatumSchema:()=>H,ONE_HOUR_MS:()=>j,ONE_YEAR_MS:()=>L,OutputReference:()=>ee,OutputReferenceSchema:()=>M,PROTOCOL_FEE:()=>ue,PROTOCOL_PAYMENT_KEY:()=>me,PROTOCOL_STAKE_KEY:()=>ye,ProtocolParametersDatum:()=>oe,ProtocolParametersDatumSchema:()=>B,REF_SCRIPT_TOKEN_NAMES:()=>xe,SYNGENTA_ORACLE_TOKEN_NAME:()=>Oe,TIME_TOLERANCE_MS:()=>fe,TWENTY_FOUR_HOURS_MS:()=>pe,TWO_YEARS_MS:()=>le,Value:()=>se,ValueSchema:()=>_,chunkArray:()=>we,deploySyngentaOracle:()=>X,divCeil:()=>Ee,filterForeignPoliciesFromAssets:()=>He,filterPolicyFromAssets:()=>_e,fromAddress:()=>Ce,fromAddressToData:()=>be,fromAssets:()=>Re,generateAccountSeedPhrase:()=>Te,getInputUtxoIndices:()=>Ve,getMultiValidator:()=>Se,getSignedOracleMessage:()=>Q,keyHashToCredentialData:()=>de,makeFreezeRedeemer:()=>Le,makeTransferRedeemer:()=>Ke,mintingMetadataFromAsset:()=>Ne,ok:()=>he,parseSafeDatum:()=>F,parseUTxOsAtScript:()=>Ae,removeAssets:()=>Be,replacer:()=>Pe,scriptHashToCredentialData:()=>ce,selectUtxos:()=>Me,sortByOutRefWithIndex:()=>W,sortUtxosByOutRef:()=>k,sumUtxoAssets:()=>ve,toAddress:()=>De,toAssets:()=>Ue,toCBORHex:()=>Ie,toCredentialData:()=>ie,union:()=>ke,updateSyngentaOracle:()=>Z,utxosAtAddressWithPolicyId:()=>je,utxosAtScript:()=>K});module.exports=J(I);var d=require("@lucid-evolution/lucid"),g=require("effect"),Q=(e,t)=>g.Effect.gen(function*(){let n=yield*g.Effect.promise(()=>e.wallet().address()),{farmerId:s,farmId:r,aeId:i,farmArea:c,farmBorders:l,sustainabilityIndex:u,additionalData:m}=t,S=[s,r,i,BigInt(c),l,BigInt(u),m],x=d.Data.to(S),p=yield*g.Effect.promise(()=>e.wallet().signMessage(n,x));return{data:t,signedOracleMessage:p}}),X=(e,t)=>g.Effect.gen(function*(){let n=e.config().network,s=yield*g.Effect.promise(()=>e.wallet().address()),{paymentCredential:r}=(0,d.getAddressDetails)(s);if(!r)throw new Error("Payment credential is undefined");let i=new d.Constr(0,[String(t.initSyngentaOracleUTxO.txHash),BigInt(t.initSyngentaOracleUTxO.outputIndex)]),c=(0,d.applyParamsToScript)(t.scripts.syngentaOracleMinting,[r.hash]),l={type:"PlutusV3",script:c},u=(0,d.mintingPolicyToId)(l),m={type:"PlutusV3",script:c},S=(0,d.validatorToAddress)(n,m),{farmerId:x,farmId:p,aeId:f,farmArea:y,farmBorders:O,sustainabilityIndex:h,additionalData:C}=t.syngentaOracleData,D=[x,p,f,BigInt(y),O,BigInt(h),C],b={syngentaOracleMinting:l,syngentaOracleSpending:m},R=d.Data.to(D),U=(0,d.toUnit)(u,(0,d.fromText)(p)),Y={[U]:1n};return{tx:yield*e.newTx().collectFrom([t.initSyngentaOracleUTxO]).pay.ToContract(S,{kind:"inline",value:R},{[U]:1n}).mintAssets(Y,d.Data.void()).attach.MintingPolicy(l).addSignerKey(r.hash).completeProgram(),syngentaOraclePolicyId:u,scripts:b}}),Z=(e,t)=>g.Effect.gen(function*(){let n=e.config().network,s=yield*g.Effect.promise(()=>e.wallet().address()),{paymentCredential:r}=(0,d.getAddressDetails)(s);if(!r)throw new Error("Payment credential is undefined");let i=(0,d.mintingPolicyToId)(t.scripts.syngentaOracleMinting),c=(0,d.toUnit)(i,(0,d.fromText)(t.farmIdToUpdate)),l=t.scripts.syngentaOracleSpending,u=(0,d.validatorToAddress)(n,l),[m,...S]=yield*g.Effect.promise(()=>e.utxosAtWithUnit(u,c)),{farmerId:x,farmId:p,aeId:f,farmArea:y,farmBorders:O,sustainabilityIndex:h,additionalData:C}=t.newSyngentaOracleData,D=[x,p,f,BigInt(y),O,BigInt(h),C],b=d.Data.to(D);return{tx:yield*e.newTx().collectFrom([m],d.Data.void()).pay.ToContract(u,{kind:"inline",value:b},{[c]:1n}).addSignerKey(r.hash).attach.SpendingValidator(t.scripts.syngentaOracleSpending).completeProgram()}});var a=require("@lucid-evolution/lucid"),M=a.Data.Object({txHash:a.Data.Bytes({minLength:32,maxLength:32}),outputIndex:a.Data.Integer()}),ee=M,A=a.Data.Enum([a.Data.Object({PublicKeyCredential:a.Data.Tuple([a.Data.Bytes()])}),a.Data.Object({ScriptCredential:a.Data.Tuple([a.Data.Bytes()])})]),te=A,V=a.Data.Object({paymentCredential:A,stakeCredential:a.Data.Nullable(a.Data.Enum([a.Data.Object({Inline:a.Data.Tuple([A])}),a.Data.Object({Pointer:a.Data.Tuple([a.Data.Object({slotNumber:a.Data.Integer(),transactionIndex:a.Data.Integer(),certificateIndex:a.Data.Integer()})])})]))}),ne=V,v=a.Data.Object({policyId:a.Data.Bytes(),assetName:a.Data.Bytes()}),re=v,_=a.Data.Map(a.Data.Bytes(),a.Data.Map(a.Data.Bytes(),a.Data.Integer())),se=_,H=a.Data.Tuple([a.Data.Bytes(),a.Data.Bytes(),A,A]),ae=H,B=a.Data.Object({directoryNodeCS:a.Data.Bytes({minLength:28,maxLength:28}),progLogicCred:A},{hasConstr:!1}),oe=B,ie=e=>e.type==="Key"?new a.Constr(0,[e.hash]):new a.Constr(1,[e.hash]),ce=e=>new a.Constr(1,[e]),de=e=>new a.Constr(0,[e]);var N=require("@lucid-evolution/lucid"),j=36e5,L=315576e5,le=2*L,pe=24*j,ue=.05,fe=process.env.NODE_ENV=="emulator"?0:1e5,me="014e9d57e1623f7eeef5d0a8d4e6734a562ba32cf910244cd74e1680",ye="5e8aa3f089868eaadf188426f49db6566624844b6c5d529b38f3b8a7",ge={policyId:"",assetName:""},xe={spendSyngentaOracle:"PSpendSyngentaOracle",mintSyngentaOracle:"PMintSyngentaOracle"},Oe=(0,N.fromText)("SyngentaOracle");var E=require("@lucid-evolution/lucid"),Se=(e,t)=>{let n={type:"PlutusV3",script:t.minting},s=e.config().network,r=(0,E.validatorToAddress)(s,n),i={type:"PlutusV3",script:t.spending},c=(0,E.validatorToAddress)(s,i);return{spendValidator:i,spendValAddress:c,mintValidator:n,mintValAddress:r}};var o=require("@lucid-evolution/lucid");function he(e){return{type:"ok",data:e}}var K=async(e,t,n)=>{let s=e.config().network,r={type:"PlutusV3",script:t},i=n?(0,o.validatorToAddress)(s,r,(0,o.keyHashToCredential)(n)):(0,o.validatorToAddress)(s,r);return e.utxosAt(i)},F=(e,t)=>{if(e)try{return{type:"right",value:o.Data.from(e,t)}}catch(n){return{type:"left",value:`invalid datum : ${n}`}}else return{type:"left",value:"missing datum"}},Ae=async(e,t,n,s)=>{try{return(await K(e,t,s)).flatMap(i=>{let c=F(i.datum,n);return c.type=="right"?{outRef:{txHash:i.txHash,outputIndex:i.outputIndex},datum:c.value,assets:i.assets}:[]})}catch{return[]}},Ie=e=>(0,o.applyDoubleCborEncoding)(e),Te=async e=>{let t=(0,o.generateSeedPhrase)(),n=await(0,o.Lucid)(new o.Emulator([]),"Custom");n.selectWallet.fromSeed(t);let s=n.wallet().address;return{seedPhrase:t,address:s,assets:e}};function Ce(e){let{paymentCredential:t,stakeCredential:n}=(0,o.getAddressDetails)(e);if(!t)throw new Error("Not a valid payment address.");return{paymentCredential:t?.type==="Key"?{PublicKeyCredential:[t.hash]}:{ScriptCredential:[t.hash]},stakeCredential:n?{Inline:[n.type==="Key"?{PublicKeyCredential:[n.hash]}:{ScriptCredential:[n.hash]}]}:null}}function De(e,t){let n=(()=>"PublicKeyCredential"in e.paymentCredential?(0,o.keyHashToCredential)(e.paymentCredential.PublicKeyCredential[0]):(0,o.scriptHashToCredential)(e.paymentCredential.ScriptCredential[0]))(),s=(()=>{if(e.stakeCredential&&"Inline"in e.stakeCredential)return"PublicKeyCredential"in e.stakeCredential.Inline[0]?(0,o.keyHashToCredential)(e.stakeCredential.Inline[0].PublicKeyCredential[0]):(0,o.scriptHashToCredential)(e.stakeCredential.Inline[0].ScriptCredential[0])})();return(0,o.credentialToAddress)(t,n,s)}var be=e=>{let t=(0,o.getAddressDetails)(e);if(!t.paymentCredential)return{type:"error",error:new Error("undefined paymentCredential")};let n=t.paymentCredential.type=="Key"?new o.Constr(0,[t.paymentCredential.hash]):new o.Constr(1,[t.paymentCredential.hash]);if(!t.stakeCredential)return{type:"ok",data:new o.Constr(0,[n,new o.Constr(1,[])])};let s=new o.Constr(0,[new o.Constr(0,[new o.Constr(0,[t.stakeCredential.hash])])]);return{type:"ok",data:new o.Constr(0,[n,s])}},we=(e,t)=>{let n=Math.ceil(e.length/t);return[...Array(n)].map((s,r)=>e.slice(r*t,(r+1)*t))},Pe=(e,t)=>typeof t=="bigint"?t.toString():t,Ee=(e,t)=>1n+(e-1n)/t;function ke(e,t){let n=Object.entries(t),s={...e};return n.forEach(([r,i])=>{s[r]?s[r]+=i:s[r]=i}),s}function Re(e){let t=new Map;e.lovelace&&t.set("",new Map([["",e.lovelace]]));let n=Object.keys(e);return Array.from(new Set(n.filter(r=>r!=="lovelace").map(r=>r.slice(0,56)))).sort().forEach(r=>{let i=n.filter(l=>l.slice(0,56)===r),c=new Map;i.sort().forEach(l=>{c.set(l.slice(56),e[l])}),t.set(r,c)}),t}function Ue(e){let t={lovelace:e.get("")?.get("")||BigInt(0)};for(let[n,s]of e)if(n!=="")for(let[r,i]of s)t[n+r]=i;return t}function Me(e,t){let n=[],s=!1,r=new Map(Object.entries(t));for(let i of e)if(!i.scriptRef){s=!1;for(let[c,l]of r)if(Object.hasOwn(i.assets,c)){let u=i.assets[c];u>=l?r.delete(c):r.set(c,l-u),s=!0}if(s&&n.push(i),r.size==0)break}return r.size>0?{type:"error",error:new Error("Insufficient funds")}:{type:"ok",data:n}}function Ve(e,t){let n=e.concat(t),s=W(n),r=new Map;return s.forEach((i,c)=>{r.set(i.txHash+i.outputIndex,BigInt(c))}),e.flatMap(i=>{let c=r.get(i.txHash+i.outputIndex);return c!==void 0?c:[]})}function W(e){return e.sort((t,n)=>t.txHash<n.txHash?-1:t.txHash>n.txHash?1:t.txHash==n.txHash?t.outputIndex<n.outputIndex?-1:1:0)}function ve(e){return e.map(t=>t.assets).reduce((t,n)=>(0,o.addAssets)(t,n),{})}function _e(e,t){return Object.fromEntries(Object.entries(e).filter(([n])=>n.startsWith(t)))}function He(e,t){return Object.fromEntries(Object.entries(e).filter(([n])=>t.includes(n.slice(0,56))))}function Be(e,t){for(let[n,s]of Object.entries(t))Object.hasOwn(e,n)&&(e[n]<s?delete e[n]:e[n]>s?e[n]-=s:delete e[n]);return e}var Ne=async(e,t)=>(await fetch(`/api/blockfrost/1/assets/${e}`,{headers:{project_id:t}}).then(s=>s.json())).onchain_metadata,je=async(e,t,n)=>(await e.utxosAt(t)).filter(r=>{let i=Object.keys(r.assets);return Array.from(new Set(i.filter(l=>l!=="lovelace").map(l=>l.slice(0,56)))).includes(n)}),k=e=>e.sort((t,n)=>t.txHash>n.txHash?1:t.txHash<n.txHash?-1:t.outputIndex>n.outputIndex?1:-1),Le=e=>{let t=e.concat(e.concat(e)).map(n=>new o.Constr(0,[n]));return console.log("Freeze Redeemer: ",t),o.Data.to(t)},Ke=({referenceInputs:e,inputs:t,outputs:n,inputSelectionCriteria:s,refInputSelectionCriteria:r,outputSelectionCriteria:i,makeRedeemer:c})=>{let u=k(e).map(p=>[p,BigInt(e.findIndex(f=>p==f))]),m;if(s&&t){let f=k(t).map(O=>[O,BigInt(t.findIndex(h=>O==h))]),y=[];for(let[O,h]of f)s(O)&&y.push(BigInt(h));m=y.length>0?y:void 0}let S;if(i&&n){let p=[];for(let[f,y]of n.entries())i(y)&&p.push(BigInt(f));S=p.length>0?p:void 0}let x=[];for(let[p,f]of u)r(p)&&x.push(BigInt(f));return c(x,m,S)};T(I,require("@lucid-evolution/lucid"),module.exports);0&&(module.exports={ADA,AddressD,AddressSchema,AssetClassD,AssetClassSchema,CredentialD,CredentialSchema,DirectoryNodeDatum,DirectoryNodeDatumSchema,ONE_HOUR_MS,ONE_YEAR_MS,OutputReference,OutputReferenceSchema,PROTOCOL_FEE,PROTOCOL_PAYMENT_KEY,PROTOCOL_STAKE_KEY,ProtocolParametersDatum,ProtocolParametersDatumSchema,REF_SCRIPT_TOKEN_NAMES,SYNGENTA_ORACLE_TOKEN_NAME,TIME_TOLERANCE_MS,TWENTY_FOUR_HOURS_MS,TWO_YEARS_MS,Value,ValueSchema,chunkArray,deploySyngentaOracle,divCeil,filterForeignPoliciesFromAssets,filterPolicyFromAssets,fromAddress,fromAddressToData,fromAssets,generateAccountSeedPhrase,getInputUtxoIndices,getMultiValidator,getSignedOracleMessage,keyHashToCredentialData,makeFreezeRedeemer,makeTransferRedeemer,mintingMetadataFromAsset,ok,parseSafeDatum,parseUTxOsAtScript,removeAssets,replacer,scriptHashToCredentialData,selectUtxos,sortByOutRefWithIndex,sortUtxosByOutRef,sumUtxoAssets,toAddress,toAssets,toCBORHex,toCredentialData,union,updateSyngentaOracle,utxosAtAddressWithPolicyId,utxosAtScript,...require("@lucid-evolution/lucid")});
