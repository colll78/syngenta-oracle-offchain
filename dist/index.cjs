"use strict";var P=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var G=(e,t)=>{for(var n in t)P(e,n,{get:t[n],enumerable:!0})},E=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of z(t))!$.call(e,r)&&r!==n&&P(e,r,{get:()=>t[r],enumerable:!(s=Y(t,r))||s.enumerable});return e},C=(e,t,n)=>(E(e,t,"default"),n&&E(n,t,"default"));var q=e=>E(P({},"__esModule",{value:!0}),e);var I={};G(I,{ADA:()=>ye,AddressD:()=>te,AddressSchema:()=>U,AssetClassD:()=>ne,AssetClassSchema:()=>V,CredentialD:()=>ee,CredentialSchema:()=>A,DirectoryNodeDatum:()=>se,DirectoryNodeDatumSchema:()=>_,ONE_HOUR_MS:()=>N,ONE_YEAR_MS:()=>j,OutputReference:()=>Z,OutputReferenceSchema:()=>M,PROTOCOL_FEE:()=>pe,PROTOCOL_PAYMENT_KEY:()=>fe,PROTOCOL_STAKE_KEY:()=>me,ProtocolParametersDatum:()=>ae,ProtocolParametersDatumSchema:()=>H,REF_SCRIPT_TOKEN_NAMES:()=>ge,SYNGENTA_ORACLE_TOKEN_NAME:()=>xe,TIME_TOLERANCE_MS:()=>ue,TWENTY_FOUR_HOURS_MS:()=>le,TWO_YEARS_MS:()=>de,Value:()=>re,ValueSchema:()=>v,chunkArray:()=>be,deploySyngentaOracle:()=>Q,divCeil:()=>Ee,filterForeignPoliciesFromAssets:()=>_e,filterPolicyFromAssets:()=>ve,fromAddress:()=>Ce,fromAddressToData:()=>De,fromAssets:()=>ke,generateAccountSeedPhrase:()=>Ie,getInputUtxoIndices:()=>Ue,getMultiValidator:()=>Oe,getSignedOracleMessage:()=>J,keyHashToCredentialData:()=>ce,makeFreezeRedeemer:()=>je,makeTransferRedeemer:()=>Le,mintingMetadataFromAsset:()=>Be,ok:()=>Se,parseSafeDatum:()=>K,parseUTxOsAtScript:()=>he,removeAssets:()=>He,replacer:()=>we,scriptHashToCredentialData:()=>ie,selectUtxos:()=>Me,sortByOutRefWithIndex:()=>F,sortUtxosByOutRef:()=>R,sumUtxoAssets:()=>Ve,toAddress:()=>Te,toAssets:()=>Re,toCBORHex:()=>Ae,toCredentialData:()=>oe,union:()=>Pe,updateSyngentaOracle:()=>X,utxosAtAddressWithPolicyId:()=>Ne,utxosAtScript:()=>L});module.exports=q(I);var d=require("@lucid-evolution/lucid"),g=require("effect"),J=(e,t)=>g.Effect.gen(function*(){let n=yield*g.Effect.promise(()=>e.wallet().address()),{farmerId:s,farmId:r,aeId:o,farmArea:c,farmBorders:l,sustainabilityIndex:u,additionalData:x}=t,S=[s,r,o,BigInt(c),l,BigInt(u),x],m=d.Data.to(S),p=yield*g.Effect.promise(()=>e.wallet().signMessage(n,m));return{data:t,signedOracleMessage:p}}),Q=(e,t)=>g.Effect.gen(function*(){let n=e.config().network,s=yield*g.Effect.promise(()=>e.wallet().address()),{paymentCredential:r}=(0,d.getAddressDetails)(s);if(!r)throw new Error("Payment credential is undefined");let o=(0,d.applyParamsToScript)(t.scripts.syngentaOracleMinting,[r.hash]),c={type:"PlutusV3",script:o},l=(0,d.mintingPolicyToId)(c),u={type:"PlutusV3",script:o},x=(0,d.validatorToAddress)(n,u),{farmerId:S,farmId:m,aeId:p,farmArea:f,farmBorders:y,sustainabilityIndex:O,additionalData:h}=t.syngentaOracleData,T=[S,m,p,BigInt(f),y,BigInt(O),h],D={syngentaOracleMinting:c,syngentaOracleSpending:u},b=d.Data.to(T),w=(0,d.toUnit)(l,(0,d.fromText)(m)),W={[w]:1n};return{tx:yield*e.newTx().pay.ToContract(x,{kind:"inline",value:b},{[w]:1n}).mintAssets(W,d.Data.void()).attach.MintingPolicy(c).addSignerKey(r.hash).completeProgram(),syngentaOraclePolicyId:l,scripts:D}}),X=(e,t)=>g.Effect.gen(function*(){let n=e.config().network,s=yield*g.Effect.promise(()=>e.wallet().address()),{paymentCredential:r}=(0,d.getAddressDetails)(s);if(!r)throw new Error("Payment credential is undefined");let o=(0,d.mintingPolicyToId)(t.scripts.syngentaOracleMinting),c=(0,d.toUnit)(o,(0,d.fromText)(t.farmIdToUpdate)),l=t.scripts.syngentaOracleSpending,u=(0,d.validatorToAddress)(n,l),[x,...S]=yield*g.Effect.promise(()=>e.utxosAtWithUnit(u,c)),{farmerId:m,farmId:p,aeId:f,farmArea:y,farmBorders:O,sustainabilityIndex:h,additionalData:T}=t.newSyngentaOracleData,D=[m,p,f,BigInt(y),O,BigInt(h),T],b=d.Data.to(D);return{tx:yield*e.newTx().collectFrom([x],d.Data.void()).pay.ToContract(u,{kind:"inline",value:b},{[c]:1n}).addSignerKey(r.hash).attach.SpendingValidator(t.scripts.syngentaOracleSpending).completeProgram()}});var a=require("@lucid-evolution/lucid"),M=a.Data.Object({txHash:a.Data.Bytes({minLength:32,maxLength:32}),outputIndex:a.Data.Integer()}),Z=M,A=a.Data.Enum([a.Data.Object({PublicKeyCredential:a.Data.Tuple([a.Data.Bytes()])}),a.Data.Object({ScriptCredential:a.Data.Tuple([a.Data.Bytes()])})]),ee=A,U=a.Data.Object({paymentCredential:A,stakeCredential:a.Data.Nullable(a.Data.Enum([a.Data.Object({Inline:a.Data.Tuple([A])}),a.Data.Object({Pointer:a.Data.Tuple([a.Data.Object({slotNumber:a.Data.Integer(),transactionIndex:a.Data.Integer(),certificateIndex:a.Data.Integer()})])})]))}),te=U,V=a.Data.Object({policyId:a.Data.Bytes(),assetName:a.Data.Bytes()}),ne=V,v=a.Data.Map(a.Data.Bytes(),a.Data.Map(a.Data.Bytes(),a.Data.Integer())),re=v,_=a.Data.Tuple([a.Data.Bytes(),a.Data.Bytes(),A,A]),se=_,H=a.Data.Object({directoryNodeCS:a.Data.Bytes({minLength:28,maxLength:28}),progLogicCred:A},{hasConstr:!1}),ae=H,oe=e=>e.type==="Key"?new a.Constr(0,[e.hash]):new a.Constr(1,[e.hash]),ie=e=>new a.Constr(1,[e]),ce=e=>new a.Constr(0,[e]);var B=require("@lucid-evolution/lucid"),N=36e5,j=315576e5,de=2*j,le=24*N,pe=.05,ue=process.env.NODE_ENV=="emulator"?0:1e5,fe="014e9d57e1623f7eeef5d0a8d4e6734a562ba32cf910244cd74e1680",me="5e8aa3f089868eaadf188426f49db6566624844b6c5d529b38f3b8a7",ye={policyId:"",assetName:""},ge={spendSyngentaOracle:"PSpendSyngentaOracle",mintSyngentaOracle:"PMintSyngentaOracle"},xe=(0,B.fromText)("SyngentaOracle");var k=require("@lucid-evolution/lucid"),Oe=(e,t)=>{let n={type:"PlutusV3",script:t.minting},s=e.config().network,r=(0,k.validatorToAddress)(s,n),o={type:"PlutusV3",script:t.spending},c=(0,k.validatorToAddress)(s,o);return{spendValidator:o,spendValAddress:c,mintValidator:n,mintValAddress:r}};var i=require("@lucid-evolution/lucid");function Se(e){return{type:"ok",data:e}}var L=async(e,t,n)=>{let s=e.config().network,r={type:"PlutusV3",script:t},o=n?(0,i.validatorToAddress)(s,r,(0,i.keyHashToCredential)(n)):(0,i.validatorToAddress)(s,r);return e.utxosAt(o)},K=(e,t)=>{if(e)try{return{type:"right",value:i.Data.from(e,t)}}catch(n){return{type:"left",value:`invalid datum : ${n}`}}else return{type:"left",value:"missing datum"}},he=async(e,t,n,s)=>{try{return(await L(e,t,s)).flatMap(o=>{let c=K(o.datum,n);return c.type=="right"?{outRef:{txHash:o.txHash,outputIndex:o.outputIndex},datum:c.value,assets:o.assets}:[]})}catch{return[]}},Ae=e=>(0,i.applyDoubleCborEncoding)(e),Ie=async e=>{let t=(0,i.generateSeedPhrase)(),n=await(0,i.Lucid)(new i.Emulator([]),"Custom");n.selectWallet.fromSeed(t);let s=n.wallet().address;return{seedPhrase:t,address:s,assets:e}};function Ce(e){let{paymentCredential:t,stakeCredential:n}=(0,i.getAddressDetails)(e);if(!t)throw new Error("Not a valid payment address.");return{paymentCredential:t?.type==="Key"?{PublicKeyCredential:[t.hash]}:{ScriptCredential:[t.hash]},stakeCredential:n?{Inline:[n.type==="Key"?{PublicKeyCredential:[n.hash]}:{ScriptCredential:[n.hash]}]}:null}}function Te(e,t){let n=(()=>"PublicKeyCredential"in e.paymentCredential?(0,i.keyHashToCredential)(e.paymentCredential.PublicKeyCredential[0]):(0,i.scriptHashToCredential)(e.paymentCredential.ScriptCredential[0]))(),s=(()=>{if(e.stakeCredential&&"Inline"in e.stakeCredential)return"PublicKeyCredential"in e.stakeCredential.Inline[0]?(0,i.keyHashToCredential)(e.stakeCredential.Inline[0].PublicKeyCredential[0]):(0,i.scriptHashToCredential)(e.stakeCredential.Inline[0].ScriptCredential[0])})();return(0,i.credentialToAddress)(t,n,s)}var De=e=>{let t=(0,i.getAddressDetails)(e);if(!t.paymentCredential)return{type:"error",error:new Error("undefined paymentCredential")};let n=t.paymentCredential.type=="Key"?new i.Constr(0,[t.paymentCredential.hash]):new i.Constr(1,[t.paymentCredential.hash]);if(!t.stakeCredential)return{type:"ok",data:new i.Constr(0,[n,new i.Constr(1,[])])};let s=new i.Constr(0,[new i.Constr(0,[new i.Constr(0,[t.stakeCredential.hash])])]);return{type:"ok",data:new i.Constr(0,[n,s])}},be=(e,t)=>{let n=Math.ceil(e.length/t);return[...Array(n)].map((s,r)=>e.slice(r*t,(r+1)*t))},we=(e,t)=>typeof t=="bigint"?t.toString():t,Ee=(e,t)=>1n+(e-1n)/t;function Pe(e,t){let n=Object.entries(t),s={...e};return n.forEach(([r,o])=>{s[r]?s[r]+=o:s[r]=o}),s}function ke(e){let t=new Map;e.lovelace&&t.set("",new Map([["",e.lovelace]]));let n=Object.keys(e);return Array.from(new Set(n.filter(r=>r!=="lovelace").map(r=>r.slice(0,56)))).sort().forEach(r=>{let o=n.filter(l=>l.slice(0,56)===r),c=new Map;o.sort().forEach(l=>{c.set(l.slice(56),e[l])}),t.set(r,c)}),t}function Re(e){let t={lovelace:e.get("")?.get("")||BigInt(0)};for(let[n,s]of e)if(n!=="")for(let[r,o]of s)t[n+r]=o;return t}function Me(e,t){let n=[],s=!1,r=new Map(Object.entries(t));for(let o of e)if(!o.scriptRef){s=!1;for(let[c,l]of r)if(Object.hasOwn(o.assets,c)){let u=o.assets[c];u>=l?r.delete(c):r.set(c,l-u),s=!0}if(s&&n.push(o),r.size==0)break}return r.size>0?{type:"error",error:new Error("Insufficient funds")}:{type:"ok",data:n}}function Ue(e,t){let n=e.concat(t),s=F(n),r=new Map;return s.forEach((o,c)=>{r.set(o.txHash+o.outputIndex,BigInt(c))}),e.flatMap(o=>{let c=r.get(o.txHash+o.outputIndex);return c!==void 0?c:[]})}function F(e){return e.sort((t,n)=>t.txHash<n.txHash?-1:t.txHash>n.txHash?1:t.txHash==n.txHash?t.outputIndex<n.outputIndex?-1:1:0)}function Ve(e){return e.map(t=>t.assets).reduce((t,n)=>(0,i.addAssets)(t,n),{})}function ve(e,t){return Object.fromEntries(Object.entries(e).filter(([n])=>n.startsWith(t)))}function _e(e,t){return Object.fromEntries(Object.entries(e).filter(([n])=>t.includes(n.slice(0,56))))}function He(e,t){for(let[n,s]of Object.entries(t))Object.hasOwn(e,n)&&(e[n]<s?delete e[n]:e[n]>s?e[n]-=s:delete e[n]);return e}var Be=async(e,t)=>(await fetch(`/api/blockfrost/1/assets/${e}`,{headers:{project_id:t}}).then(s=>s.json())).onchain_metadata,Ne=async(e,t,n)=>(await e.utxosAt(t)).filter(r=>{let o=Object.keys(r.assets);return Array.from(new Set(o.filter(l=>l!=="lovelace").map(l=>l.slice(0,56)))).includes(n)}),R=e=>e.sort((t,n)=>t.txHash>n.txHash?1:t.txHash<n.txHash?-1:t.outputIndex>n.outputIndex?1:-1),je=e=>{let t=e.concat(e.concat(e)).map(n=>new i.Constr(0,[n]));return console.log("Freeze Redeemer: ",t),i.Data.to(t)},Le=({referenceInputs:e,inputs:t,outputs:n,inputSelectionCriteria:s,refInputSelectionCriteria:r,outputSelectionCriteria:o,makeRedeemer:c})=>{let u=R(e).map(p=>[p,BigInt(e.findIndex(f=>p==f))]),x;if(s&&t){let f=R(t).map(O=>[O,BigInt(t.findIndex(h=>O==h))]),y=[];for(let[O,h]of f)s(O)&&y.push(BigInt(h));x=y.length>0?y:void 0}let S;if(o&&n){let p=[];for(let[f,y]of n.entries())o(y)&&p.push(BigInt(f));S=p.length>0?p:void 0}let m=[];for(let[p,f]of u)r(p)&&m.push(BigInt(f));return c(m,x,S)};C(I,require("@lucid-evolution/lucid"),module.exports);0&&(module.exports={ADA,AddressD,AddressSchema,AssetClassD,AssetClassSchema,CredentialD,CredentialSchema,DirectoryNodeDatum,DirectoryNodeDatumSchema,ONE_HOUR_MS,ONE_YEAR_MS,OutputReference,OutputReferenceSchema,PROTOCOL_FEE,PROTOCOL_PAYMENT_KEY,PROTOCOL_STAKE_KEY,ProtocolParametersDatum,ProtocolParametersDatumSchema,REF_SCRIPT_TOKEN_NAMES,SYNGENTA_ORACLE_TOKEN_NAME,TIME_TOLERANCE_MS,TWENTY_FOUR_HOURS_MS,TWO_YEARS_MS,Value,ValueSchema,chunkArray,deploySyngentaOracle,divCeil,filterForeignPoliciesFromAssets,filterPolicyFromAssets,fromAddress,fromAddressToData,fromAssets,generateAccountSeedPhrase,getInputUtxoIndices,getMultiValidator,getSignedOracleMessage,keyHashToCredentialData,makeFreezeRedeemer,makeTransferRedeemer,mintingMetadataFromAsset,ok,parseSafeDatum,parseUTxOsAtScript,removeAssets,replacer,scriptHashToCredentialData,selectUtxos,sortByOutRefWithIndex,sortUtxosByOutRef,sumUtxoAssets,toAddress,toAssets,toCBORHex,toCredentialData,union,updateSyngentaOracle,utxosAtAddressWithPolicyId,utxosAtScript,...require("@lucid-evolution/lucid")});
