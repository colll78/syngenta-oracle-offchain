"use strict";var R=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var Q=(e,t)=>{for(var n in t)R(e,n,{get:t[n],enumerable:!0})},k=(e,t,n,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of q(t))!J.call(e,r)&&r!==n&&R(e,r,{get:()=>t[r],enumerable:!(s=G(t,r))||s.enumerable});return e},b=(e,t,n)=>(k(e,t,"default"),n&&k(n,t,"default"));var X=e=>k(R({},"__esModule",{value:!0}),e);var I={};Q(I,{ADA:()=>Se,AddressD:()=>ae,AddressSchema:()=>V,AssetClassD:()=>oe,AssetClassSchema:()=>B,CredentialD:()=>se,CredentialSchema:()=>A,DirectoryNodeDatum:()=>ce,DirectoryNodeDatumSchema:()=>H,ONE_HOUR_MS:()=>L,ONE_YEAR_MS:()=>K,OutputReference:()=>re,OutputReferenceSchema:()=>v,PROTOCOL_FEE:()=>ge,PROTOCOL_PAYMENT_KEY:()=>xe,PROTOCOL_STAKE_KEY:()=>Oe,ProtocolParametersDatum:()=>de,ProtocolParametersDatumSchema:()=>N,REF_SCRIPT_TOKEN_NAMES:()=>he,SYNGENTA_ORACLE_TOKEN_NAME:()=>Ae,TIME_TOLERANCE_MS:()=>me,TWENTY_FOUR_HOURS_MS:()=>fe,TWO_YEARS_MS:()=>ye,Value:()=>ie,ValueSchema:()=>_,batchDeploySyngentaOracle:()=>ne,chunkArray:()=>ke,deploySyngentaOracle:()=>ee,divCeil:()=>Me,filterForeignPoliciesFromAssets:()=>je,filterPolicyFromAssets:()=>Ne,fromAddress:()=>be,fromAddressToData:()=>Ee,fromAssets:()=>ve,generateAccountSeedPhrase:()=>we,getInputUtxoIndices:()=>_e,getMultiValidator:()=>Ie,getSignedOracleMessage:()=>Z,keyHashToCredentialData:()=>ue,makeFreezeRedeemer:()=>We,makeTransferRedeemer:()=>Ye,mintingMetadataFromAsset:()=>Ke,ok:()=>Ce,parseSafeDatum:()=>W,parseUTxOsAtScript:()=>Te,removeAssets:()=>Le,replacer:()=>Re,scriptHashToCredentialData:()=>pe,selectUtxos:()=>Be,sortByOutRefWithIndex:()=>Y,sortUtxosByOutRef:()=>U,sumUtxoAssets:()=>He,toAddress:()=>Pe,toAssets:()=>Ve,toCBORHex:()=>De,toCredentialData:()=>le,union:()=>Ue,updateSyngentaOracle:()=>te,utxosAtAddressWithPolicyId:()=>Fe,utxosAtScript:()=>F});module.exports=X(I);var d=require("@lucid-evolution/lucid"),m=require("effect"),Z=(e,t)=>m.Effect.gen(function*(){let n=yield*m.Effect.promise(()=>e.wallet().address()),{farmerId:s,farmId:r,aeId:a,farmArea:c,farmBorders:l,sustainabilityIndex:u,additionalData:x}=t,h=[s,r,a,BigInt(c),l,BigInt(u),x],f=d.Data.to(h),p=yield*m.Effect.promise(()=>e.wallet().signMessage(n,f));return{data:t,signedOracleMessage:p}}),ee=(e,t)=>m.Effect.gen(function*(){let n=e.config().network,s=yield*m.Effect.promise(()=>e.wallet().address()),{paymentCredential:r}=(0,d.getAddressDetails)(s);if(!r)throw new Error("Payment credential is undefined");let a=(0,d.applyParamsToScript)(t.scripts.syngentaOracleMinting,[r.hash]),c={type:"PlutusV3",script:a},l=(0,d.mintingPolicyToId)(c),u={type:"PlutusV3",script:a},x=(0,d.validatorToAddress)(n,u),{farmerId:h,farmId:f,aeId:p,farmArea:y,farmBorders:g,sustainabilityIndex:O,additionalData:S}=t.syngentaOracleData,C=[h,f,p,BigInt(y),g,BigInt(O),S],T={syngentaOracleMinting:c,syngentaOracleSpending:u},D=d.Data.to(C),w=(0,d.toUnit)(l,(0,d.fromText)(f)),P={[w]:1n};return{tx:yield*e.newTx().pay.ToContract(x,{kind:"inline",value:D},{[w]:1n}).mintAssets(P,d.Data.void()).attach.MintingPolicy(c).addSignerKey(r.hash).completeProgram(),syngentaOraclePolicyId:l,scripts:T}}),te=(e,t)=>m.Effect.gen(function*(){let n=e.config().network,s=yield*m.Effect.promise(()=>e.wallet().address()),{paymentCredential:r}=(0,d.getAddressDetails)(s);if(!r)throw new Error("Payment credential is undefined");let a=(0,d.mintingPolicyToId)(t.scripts.syngentaOracleMinting),c=(0,d.toUnit)(a,(0,d.fromText)(t.farmIdToUpdate)),l=t.scripts.syngentaOracleSpending,u=(0,d.validatorToAddress)(n,l),[x,...h]=yield*m.Effect.promise(()=>e.utxosAtWithUnit(u,c)),{farmerId:f,farmId:p,aeId:y,farmArea:g,farmBorders:O,sustainabilityIndex:S,additionalData:C}=t.newSyngentaOracleData,T=[f,p,y,BigInt(g),O,BigInt(S),C],D=d.Data.to(T);return{tx:yield*e.newTx().collectFrom([x],d.Data.void()).pay.ToContract(u,{kind:"inline",value:D},{[c]:1n}).addSignerKey(r.hash).attach.SpendingValidator(t.scripts.syngentaOracleSpending).completeProgram()}}),ne=(e,t)=>m.Effect.gen(function*(){let n=e.config().network,s=yield*m.Effect.promise(()=>e.wallet().address()),{paymentCredential:r}=(0,d.getAddressDetails)(s);if(!r)throw new Error("Payment credential is undefined");let a=(0,d.applyParamsToScript)(t.scripts.syngentaOracleMinting,[r.hash]),c={type:"PlutusV3",script:a},l=(0,d.mintingPolicyToId)(c),u={type:"PlutusV3",script:a},x=(0,d.validatorToAddress)(n,u),h={syngentaOracleMinting:c,syngentaOracleSpending:u},f={},p=e.newTx();for(let g of t.batchSyngentaOracleData){let{farmerId:O,farmId:S,aeId:C,farmArea:T,farmBorders:D,sustainabilityIndex:w,additionalData:P}=g,E=(0,d.toUnit)(l,(0,d.fromText)(S));f[E]=1n;let z=[O,S,C,BigInt(T),D,BigInt(w),P],$=d.Data.to(z);p=p.pay.ToContract(x,{kind:"inline",value:$},{[E]:1n})}return{tx:yield*p.mintAssets(f,d.Data.void()).attach.MintingPolicy(c).addSignerKey(r.hash).completeProgram(),syngentaOraclePolicyId:l,scripts:h}});var o=require("@lucid-evolution/lucid"),v=o.Data.Object({txHash:o.Data.Bytes({minLength:32,maxLength:32}),outputIndex:o.Data.Integer()}),re=v,A=o.Data.Enum([o.Data.Object({PublicKeyCredential:o.Data.Tuple([o.Data.Bytes()])}),o.Data.Object({ScriptCredential:o.Data.Tuple([o.Data.Bytes()])})]),se=A,V=o.Data.Object({paymentCredential:A,stakeCredential:o.Data.Nullable(o.Data.Enum([o.Data.Object({Inline:o.Data.Tuple([A])}),o.Data.Object({Pointer:o.Data.Tuple([o.Data.Object({slotNumber:o.Data.Integer(),transactionIndex:o.Data.Integer(),certificateIndex:o.Data.Integer()})])})]))}),ae=V,B=o.Data.Object({policyId:o.Data.Bytes(),assetName:o.Data.Bytes()}),oe=B,_=o.Data.Map(o.Data.Bytes(),o.Data.Map(o.Data.Bytes(),o.Data.Integer())),ie=_,H=o.Data.Tuple([o.Data.Bytes(),o.Data.Bytes(),A,A]),ce=H,N=o.Data.Object({directoryNodeCS:o.Data.Bytes({minLength:28,maxLength:28}),progLogicCred:A},{hasConstr:!1}),de=N,le=e=>e.type==="Key"?new o.Constr(0,[e.hash]):new o.Constr(1,[e.hash]),pe=e=>new o.Constr(1,[e]),ue=e=>new o.Constr(0,[e]);var j=require("@lucid-evolution/lucid"),L=36e5,K=315576e5,ye=2*K,fe=24*L,ge=.05,me=process.env.NODE_ENV=="emulator"?0:1e5,xe="014e9d57e1623f7eeef5d0a8d4e6734a562ba32cf910244cd74e1680",Oe="5e8aa3f089868eaadf188426f49db6566624844b6c5d529b38f3b8a7",Se={policyId:"",assetName:""},he={spendSyngentaOracle:"PSpendSyngentaOracle",mintSyngentaOracle:"PMintSyngentaOracle"},Ae=(0,j.fromText)("SyngentaOracle");var M=require("@lucid-evolution/lucid"),Ie=(e,t)=>{let n={type:"PlutusV3",script:t.minting},s=e.config().network,r=(0,M.validatorToAddress)(s,n),a={type:"PlutusV3",script:t.spending},c=(0,M.validatorToAddress)(s,a);return{spendValidator:a,spendValAddress:c,mintValidator:n,mintValAddress:r}};var i=require("@lucid-evolution/lucid");function Ce(e){return{type:"ok",data:e}}var F=async(e,t,n)=>{let s=e.config().network,r={type:"PlutusV3",script:t},a=n?(0,i.validatorToAddress)(s,r,(0,i.keyHashToCredential)(n)):(0,i.validatorToAddress)(s,r);return e.utxosAt(a)},W=(e,t)=>{if(e)try{return{type:"right",value:i.Data.from(e,t)}}catch(n){return{type:"left",value:`invalid datum : ${n}`}}else return{type:"left",value:"missing datum"}},Te=async(e,t,n,s)=>{try{return(await F(e,t,s)).flatMap(a=>{let c=W(a.datum,n);return c.type=="right"?{outRef:{txHash:a.txHash,outputIndex:a.outputIndex},datum:c.value,assets:a.assets}:[]})}catch{return[]}},De=e=>(0,i.applyDoubleCborEncoding)(e),we=async e=>{let t=(0,i.generateSeedPhrase)(),n=await(0,i.Lucid)(new i.Emulator([]),"Custom");n.selectWallet.fromSeed(t);let s=n.wallet().address;return{seedPhrase:t,address:s,assets:e}};function be(e){let{paymentCredential:t,stakeCredential:n}=(0,i.getAddressDetails)(e);if(!t)throw new Error("Not a valid payment address.");return{paymentCredential:t?.type==="Key"?{PublicKeyCredential:[t.hash]}:{ScriptCredential:[t.hash]},stakeCredential:n?{Inline:[n.type==="Key"?{PublicKeyCredential:[n.hash]}:{ScriptCredential:[n.hash]}]}:null}}function Pe(e,t){let n=(()=>"PublicKeyCredential"in e.paymentCredential?(0,i.keyHashToCredential)(e.paymentCredential.PublicKeyCredential[0]):(0,i.scriptHashToCredential)(e.paymentCredential.ScriptCredential[0]))(),s=(()=>{if(e.stakeCredential&&"Inline"in e.stakeCredential)return"PublicKeyCredential"in e.stakeCredential.Inline[0]?(0,i.keyHashToCredential)(e.stakeCredential.Inline[0].PublicKeyCredential[0]):(0,i.scriptHashToCredential)(e.stakeCredential.Inline[0].ScriptCredential[0])})();return(0,i.credentialToAddress)(t,n,s)}var Ee=e=>{let t=(0,i.getAddressDetails)(e);if(!t.paymentCredential)return{type:"error",error:new Error("undefined paymentCredential")};let n=t.paymentCredential.type=="Key"?new i.Constr(0,[t.paymentCredential.hash]):new i.Constr(1,[t.paymentCredential.hash]);if(!t.stakeCredential)return{type:"ok",data:new i.Constr(0,[n,new i.Constr(1,[])])};let s=new i.Constr(0,[new i.Constr(0,[new i.Constr(0,[t.stakeCredential.hash])])]);return{type:"ok",data:new i.Constr(0,[n,s])}},ke=(e,t)=>{let n=Math.ceil(e.length/t);return[...Array(n)].map((s,r)=>e.slice(r*t,(r+1)*t))},Re=(e,t)=>typeof t=="bigint"?t.toString():t,Me=(e,t)=>1n+(e-1n)/t;function Ue(e,t){let n=Object.entries(t),s={...e};return n.forEach(([r,a])=>{s[r]?s[r]+=a:s[r]=a}),s}function ve(e){let t=new Map;e.lovelace&&t.set("",new Map([["",e.lovelace]]));let n=Object.keys(e);return Array.from(new Set(n.filter(r=>r!=="lovelace").map(r=>r.slice(0,56)))).sort().forEach(r=>{let a=n.filter(l=>l.slice(0,56)===r),c=new Map;a.sort().forEach(l=>{c.set(l.slice(56),e[l])}),t.set(r,c)}),t}function Ve(e){let t={lovelace:e.get("")?.get("")||BigInt(0)};for(let[n,s]of e)if(n!=="")for(let[r,a]of s)t[n+r]=a;return t}function Be(e,t){let n=[],s=!1,r=new Map(Object.entries(t));for(let a of e)if(!a.scriptRef){s=!1;for(let[c,l]of r)if(Object.hasOwn(a.assets,c)){let u=a.assets[c];u>=l?r.delete(c):r.set(c,l-u),s=!0}if(s&&n.push(a),r.size==0)break}return r.size>0?{type:"error",error:new Error("Insufficient funds")}:{type:"ok",data:n}}function _e(e,t){let n=e.concat(t),s=Y(n),r=new Map;return s.forEach((a,c)=>{r.set(a.txHash+a.outputIndex,BigInt(c))}),e.flatMap(a=>{let c=r.get(a.txHash+a.outputIndex);return c!==void 0?c:[]})}function Y(e){return e.sort((t,n)=>t.txHash<n.txHash?-1:t.txHash>n.txHash?1:t.txHash==n.txHash?t.outputIndex<n.outputIndex?-1:1:0)}function He(e){return e.map(t=>t.assets).reduce((t,n)=>(0,i.addAssets)(t,n),{})}function Ne(e,t){return Object.fromEntries(Object.entries(e).filter(([n])=>n.startsWith(t)))}function je(e,t){return Object.fromEntries(Object.entries(e).filter(([n])=>t.includes(n.slice(0,56))))}function Le(e,t){for(let[n,s]of Object.entries(t))Object.hasOwn(e,n)&&(e[n]<s?delete e[n]:e[n]>s?e[n]-=s:delete e[n]);return e}var Ke=async(e,t)=>(await fetch(`/api/blockfrost/1/assets/${e}`,{headers:{project_id:t}}).then(s=>s.json())).onchain_metadata,Fe=async(e,t,n)=>(await e.utxosAt(t)).filter(r=>{let a=Object.keys(r.assets);return Array.from(new Set(a.filter(l=>l!=="lovelace").map(l=>l.slice(0,56)))).includes(n)}),U=e=>e.sort((t,n)=>t.txHash>n.txHash?1:t.txHash<n.txHash?-1:t.outputIndex>n.outputIndex?1:-1),We=e=>{let t=e.concat(e.concat(e)).map(n=>new i.Constr(0,[n]));return console.log("Freeze Redeemer: ",t),i.Data.to(t)},Ye=({referenceInputs:e,inputs:t,outputs:n,inputSelectionCriteria:s,refInputSelectionCriteria:r,outputSelectionCriteria:a,makeRedeemer:c})=>{let u=U(e).map(p=>[p,BigInt(e.findIndex(y=>p==y))]),x;if(s&&t){let y=U(t).map(O=>[O,BigInt(t.findIndex(S=>O==S))]),g=[];for(let[O,S]of y)s(O)&&g.push(BigInt(S));x=g.length>0?g:void 0}let h;if(a&&n){let p=[];for(let[y,g]of n.entries())a(g)&&p.push(BigInt(y));h=p.length>0?p:void 0}let f=[];for(let[p,y]of u)r(p)&&f.push(BigInt(y));return c(f,x,h)};b(I,require("@lucid-evolution/lucid"),module.exports);0&&(module.exports={ADA,AddressD,AddressSchema,AssetClassD,AssetClassSchema,CredentialD,CredentialSchema,DirectoryNodeDatum,DirectoryNodeDatumSchema,ONE_HOUR_MS,ONE_YEAR_MS,OutputReference,OutputReferenceSchema,PROTOCOL_FEE,PROTOCOL_PAYMENT_KEY,PROTOCOL_STAKE_KEY,ProtocolParametersDatum,ProtocolParametersDatumSchema,REF_SCRIPT_TOKEN_NAMES,SYNGENTA_ORACLE_TOKEN_NAME,TIME_TOLERANCE_MS,TWENTY_FOUR_HOURS_MS,TWO_YEARS_MS,Value,ValueSchema,batchDeploySyngentaOracle,chunkArray,deploySyngentaOracle,divCeil,filterForeignPoliciesFromAssets,filterPolicyFromAssets,fromAddress,fromAddressToData,fromAssets,generateAccountSeedPhrase,getInputUtxoIndices,getMultiValidator,getSignedOracleMessage,keyHashToCredentialData,makeFreezeRedeemer,makeTransferRedeemer,mintingMetadataFromAsset,ok,parseSafeDatum,parseUTxOsAtScript,removeAssets,replacer,scriptHashToCredentialData,selectUtxos,sortByOutRefWithIndex,sortUtxosByOutRef,sumUtxoAssets,toAddress,toAssets,toCBORHex,toCredentialData,union,updateSyngentaOracle,utxosAtAddressWithPolicyId,utxosAtScript,...require("@lucid-evolution/lucid")});
