import{applyParamsToScript as V,Data as h,getAddressDetails as E,mintingPolicyToId as k,toUnit as R,validatorToAddress as M,fromText as U}from"@lucid-evolution/lucid";import{Effect as x}from"effect";var Ce=(e,t)=>x.gen(function*(){let n=yield*x.promise(()=>e.wallet().address()),{farmerId:s,farmId:r,aeId:a,farmArea:i,farmBorders:c,sustainabilityIndex:l,additionalData:f}=t,O=[s,r,a,BigInt(i),c,BigInt(l),f],u=h.to(O),d=yield*x.promise(()=>e.wallet().signMessage(n,u));return{data:t,signedOracleMessage:d}}),Te=(e,t)=>x.gen(function*(){let n=e.config().network,s=yield*x.promise(()=>e.wallet().address()),{paymentCredential:r}=E(s);if(!r)throw new Error("Payment credential is undefined");let a=V(t.scripts.syngentaOracleMinting,[r.hash]),i={type:"PlutusV3",script:a},c=k(i),l={type:"PlutusV3",script:a},f=M(n,l),{farmerId:O,farmId:u,aeId:d,farmArea:p,farmBorders:y,sustainabilityIndex:g,additionalData:m}=t.syngentaOracleData,I=[O,u,d,BigInt(p),y,BigInt(g),m],C={syngentaOracleMinting:i,syngentaOracleSpending:l},T=h.to(I),D=R(c,U(u)),b={[D]:1n};return{tx:yield*e.newTx().pay.ToContract(f,{kind:"inline",value:T},{[D]:1n}).mintAssets(b,h.void()).attach.MintingPolicy(i).addSignerKey(r.hash).completeProgram(),syngentaOraclePolicyId:c,scripts:C}}),De=(e,t)=>x.gen(function*(){let n=e.config().network,s=yield*x.promise(()=>e.wallet().address()),{paymentCredential:r}=E(s);if(!r)throw new Error("Payment credential is undefined");let a=k(t.scripts.syngentaOracleMinting),i=R(a,U(t.farmIdToUpdate)),c=t.scripts.syngentaOracleSpending,l=M(n,c),[f,...O]=yield*x.promise(()=>e.utxosAtWithUnit(l,i)),{farmerId:u,farmId:d,aeId:p,farmArea:y,farmBorders:g,sustainabilityIndex:m,additionalData:I}=t.newSyngentaOracleData,C=[u,d,p,BigInt(y),g,BigInt(m),I],T=h.to(C);return{tx:yield*e.newTx().collectFrom([f],h.void()).pay.ToContract(l,{kind:"inline",value:T},{[i]:1n}).addSignerKey(r.hash).attach.SpendingValidator(t.scripts.syngentaOracleSpending).completeProgram()}}),we=(e,t)=>x.gen(function*(){let n=e.config().network,s=yield*x.promise(()=>e.wallet().address()),{paymentCredential:r}=E(s);if(!r)throw new Error("Payment credential is undefined");let a=V(t.scripts.syngentaOracleMinting,[r.hash]),i={type:"PlutusV3",script:a},c=k(i),l={type:"PlutusV3",script:a},f=M(n,l),O={syngentaOracleMinting:i,syngentaOracleSpending:l},u={},d=e.newTx();for(let y of t.batchSyngentaOracleData){let{farmerId:g,farmId:m,aeId:I,farmArea:C,farmBorders:T,sustainabilityIndex:D,additionalData:b}=y,P=R(c,U(m));u[P]=1n;let K=[g,m,I,BigInt(C),T,BigInt(D),b],F=h.to(K);d=d.pay.ToContract(f,{kind:"inline",value:F},{[P]:1n})}return{tx:yield*d.mintAssets(u,h.void()).attach.MintingPolicy(i).addSignerKey(r.hash).completeProgram(),syngentaOraclePolicyId:c,scripts:O}});import{Constr as w,Data as o}from"@lucid-evolution/lucid";var W=o.Object({txHash:o.Bytes({minLength:32,maxLength:32}),outputIndex:o.Integer()}),Ve=W,A=o.Enum([o.Object({PublicKeyCredential:o.Tuple([o.Bytes()])}),o.Object({ScriptCredential:o.Tuple([o.Bytes()])})]),Be=A,Y=o.Object({paymentCredential:A,stakeCredential:o.Nullable(o.Enum([o.Object({Inline:o.Tuple([A])}),o.Object({Pointer:o.Tuple([o.Object({slotNumber:o.Integer(),transactionIndex:o.Integer(),certificateIndex:o.Integer()})])})]))}),_e=Y,z=o.Object({policyId:o.Bytes(),assetName:o.Bytes()}),He=z,$=o.Map(o.Bytes(),o.Map(o.Bytes(),o.Integer())),Ne=$,G=o.Tuple([o.Bytes(),o.Bytes(),A,A]),je=G,q=o.Object({directoryNodeCS:o.Bytes({minLength:28,maxLength:28}),progLogicCred:A},{hasConstr:!1}),Le=q,Ke=e=>e.type==="Key"?new w(0,[e.hash]):new w(1,[e.hash]),Fe=e=>new w(1,[e]),We=e=>new w(0,[e]);import{fromText as J}from"@lucid-evolution/lucid";var Q=36e5,X=315576e5,$e=2*X,Ge=24*Q,qe=.05,Je=process.env.NODE_ENV=="emulator"?0:1e5,Qe="014e9d57e1623f7eeef5d0a8d4e6734a562ba32cf910244cd74e1680",Xe="5e8aa3f089868eaadf188426f49db6566624844b6c5d529b38f3b8a7",Ze={policyId:"",assetName:""},et={spendSyngentaOracle:"PSpendSyngentaOracle",mintSyngentaOracle:"PMintSyngentaOracle"},tt=J("SyngentaOracle");import{validatorToAddress as B}from"@lucid-evolution/lucid";var lt=(e,t)=>{let n={type:"PlutusV3",script:t.minting},s=e.config().network,r=B(s,n),a={type:"PlutusV3",script:t.spending},i=B(s,a);return{spendValidator:a,spendValAddress:i,mintValidator:n,mintValAddress:r}};import{addAssets as Z,applyDoubleCborEncoding as ee,Constr as S,credentialToAddress as te,Data as j,Emulator as ne,generateSeedPhrase as re,getAddressDetails as L,keyHashToCredential as v,Lucid as se,scriptHashToCredential as _,validatorToAddress as H}from"@lucid-evolution/lucid";function It(e){return{type:"ok",data:e}}var ae=async(e,t,n)=>{let s=e.config().network,r={type:"PlutusV3",script:t},a=n?H(s,r,v(n)):H(s,r);return e.utxosAt(a)},oe=(e,t)=>{if(e)try{return{type:"right",value:j.from(e,t)}}catch(n){return{type:"left",value:`invalid datum : ${n}`}}else return{type:"left",value:"missing datum"}},Ct=async(e,t,n,s)=>{try{return(await ae(e,t,s)).flatMap(a=>{let i=oe(a.datum,n);return i.type=="right"?{outRef:{txHash:a.txHash,outputIndex:a.outputIndex},datum:i.value,assets:a.assets}:[]})}catch{return[]}},Tt=e=>ee(e),Dt=async e=>{let t=re(),n=await se(new ne([]),"Custom");n.selectWallet.fromSeed(t);let s=n.wallet().address;return{seedPhrase:t,address:s,assets:e}};function wt(e){let{paymentCredential:t,stakeCredential:n}=L(e);if(!t)throw new Error("Not a valid payment address.");return{paymentCredential:t?.type==="Key"?{PublicKeyCredential:[t.hash]}:{ScriptCredential:[t.hash]},stakeCredential:n?{Inline:[n.type==="Key"?{PublicKeyCredential:[n.hash]}:{ScriptCredential:[n.hash]}]}:null}}function bt(e,t){let n=(()=>"PublicKeyCredential"in e.paymentCredential?v(e.paymentCredential.PublicKeyCredential[0]):_(e.paymentCredential.ScriptCredential[0]))(),s=(()=>{if(e.stakeCredential&&"Inline"in e.stakeCredential)return"PublicKeyCredential"in e.stakeCredential.Inline[0]?v(e.stakeCredential.Inline[0].PublicKeyCredential[0]):_(e.stakeCredential.Inline[0].ScriptCredential[0])})();return te(t,n,s)}var Pt=e=>{let t=L(e);if(!t.paymentCredential)return{type:"error",error:new Error("undefined paymentCredential")};let n=t.paymentCredential.type=="Key"?new S(0,[t.paymentCredential.hash]):new S(1,[t.paymentCredential.hash]);if(!t.stakeCredential)return{type:"ok",data:new S(0,[n,new S(1,[])])};let s=new S(0,[new S(0,[new S(0,[t.stakeCredential.hash])])]);return{type:"ok",data:new S(0,[n,s])}},Et=(e,t)=>{let n=Math.ceil(e.length/t);return[...Array(n)].map((s,r)=>e.slice(r*t,(r+1)*t))},kt=(e,t)=>typeof t=="bigint"?t.toString():t,Rt=(e,t)=>1n+(e-1n)/t;function Mt(e,t){let n=Object.entries(t),s={...e};return n.forEach(([r,a])=>{s[r]?s[r]+=a:s[r]=a}),s}function Ut(e){let t=new Map;e.lovelace&&t.set("",new Map([["",e.lovelace]]));let n=Object.keys(e);return Array.from(new Set(n.filter(r=>r!=="lovelace").map(r=>r.slice(0,56)))).sort().forEach(r=>{let a=n.filter(c=>c.slice(0,56)===r),i=new Map;a.sort().forEach(c=>{i.set(c.slice(56),e[c])}),t.set(r,i)}),t}function vt(e){let t={lovelace:e.get("")?.get("")||BigInt(0)};for(let[n,s]of e)if(n!=="")for(let[r,a]of s)t[n+r]=a;return t}function Vt(e,t){let n=[],s=!1,r=new Map(Object.entries(t));for(let a of e)if(!a.scriptRef){s=!1;for(let[i,c]of r)if(Object.hasOwn(a.assets,i)){let l=a.assets[i];l>=c?r.delete(i):r.set(i,c-l),s=!0}if(s&&n.push(a),r.size==0)break}return r.size>0?{type:"error",error:new Error("Insufficient funds")}:{type:"ok",data:n}}function Bt(e,t){let n=e.concat(t),s=ie(n),r=new Map;return s.forEach((a,i)=>{r.set(a.txHash+a.outputIndex,BigInt(i))}),e.flatMap(a=>{let i=r.get(a.txHash+a.outputIndex);return i!==void 0?i:[]})}function ie(e){return e.sort((t,n)=>t.txHash<n.txHash?-1:t.txHash>n.txHash?1:t.txHash==n.txHash?t.outputIndex<n.outputIndex?-1:1:0)}function _t(e){return e.map(t=>t.assets).reduce((t,n)=>Z(t,n),{})}function Ht(e,t){return Object.fromEntries(Object.entries(e).filter(([n])=>n.startsWith(t)))}function Nt(e,t){return Object.fromEntries(Object.entries(e).filter(([n])=>t.includes(n.slice(0,56))))}function jt(e,t){for(let[n,s]of Object.entries(t))Object.hasOwn(e,n)&&(e[n]<s?delete e[n]:e[n]>s?e[n]-=s:delete e[n]);return e}var Lt=async(e,t)=>(await fetch(`/api/blockfrost/1/assets/${e}`,{headers:{project_id:t}}).then(s=>s.json())).onchain_metadata,Kt=async(e,t,n)=>(await e.utxosAt(t)).filter(r=>{let a=Object.keys(r.assets);return Array.from(new Set(a.filter(c=>c!=="lovelace").map(c=>c.slice(0,56)))).includes(n)}),N=e=>e.sort((t,n)=>t.txHash>n.txHash?1:t.txHash<n.txHash?-1:t.outputIndex>n.outputIndex?1:-1),Ft=e=>{let t=e.concat(e.concat(e)).map(n=>new S(0,[n]));return console.log("Freeze Redeemer: ",t),j.to(t)},Wt=({referenceInputs:e,inputs:t,outputs:n,inputSelectionCriteria:s,refInputSelectionCriteria:r,outputSelectionCriteria:a,makeRedeemer:i})=>{let l=N(e).map(d=>[d,BigInt(e.findIndex(p=>d==p))]),f;if(s&&t){let p=N(t).map(g=>[g,BigInt(t.findIndex(m=>g==m))]),y=[];for(let[g,m]of p)s(g)&&y.push(BigInt(m));f=y.length>0?y:void 0}let O;if(a&&n){let d=[];for(let[p,y]of n.entries())a(y)&&d.push(BigInt(p));O=d.length>0?d:void 0}let u=[];for(let[d,p]of l)r(d)&&u.push(BigInt(p));return i(u,f,O)};export*from"@lucid-evolution/lucid";export{Ze as ADA,_e as AddressD,Y as AddressSchema,He as AssetClassD,z as AssetClassSchema,Be as CredentialD,A as CredentialSchema,je as DirectoryNodeDatum,G as DirectoryNodeDatumSchema,Q as ONE_HOUR_MS,X as ONE_YEAR_MS,Ve as OutputReference,W as OutputReferenceSchema,qe as PROTOCOL_FEE,Qe as PROTOCOL_PAYMENT_KEY,Xe as PROTOCOL_STAKE_KEY,Le as ProtocolParametersDatum,q as ProtocolParametersDatumSchema,et as REF_SCRIPT_TOKEN_NAMES,tt as SYNGENTA_ORACLE_TOKEN_NAME,Je as TIME_TOLERANCE_MS,Ge as TWENTY_FOUR_HOURS_MS,$e as TWO_YEARS_MS,Ne as Value,$ as ValueSchema,we as batchDeploySyngentaOracle,Et as chunkArray,Te as deploySyngentaOracle,Rt as divCeil,Nt as filterForeignPoliciesFromAssets,Ht as filterPolicyFromAssets,wt as fromAddress,Pt as fromAddressToData,Ut as fromAssets,Dt as generateAccountSeedPhrase,Bt as getInputUtxoIndices,lt as getMultiValidator,Ce as getSignedOracleMessage,We as keyHashToCredentialData,Ft as makeFreezeRedeemer,Wt as makeTransferRedeemer,Lt as mintingMetadataFromAsset,It as ok,oe as parseSafeDatum,Ct as parseUTxOsAtScript,jt as removeAssets,kt as replacer,Fe as scriptHashToCredentialData,Vt as selectUtxos,ie as sortByOutRefWithIndex,N as sortUtxosByOutRef,_t as sumUtxoAssets,bt as toAddress,vt as toAssets,Tt as toCBORHex,Ke as toCredentialData,Mt as union,De as updateSyngentaOracle,Kt as utxosAtAddressWithPolicyId,ae as utxosAtScript};
