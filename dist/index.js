import{applyParamsToScript as j,Data as A,getAddressDetails as E,mintingPolicyToId as P,toUnit as k,validatorToAddress as R,fromText as M}from"@lucid-evolution/lucid";import{Effect as x}from"effect";var Ae=(e,t)=>x.gen(function*(){let n=yield*x.promise(()=>e.wallet().address()),{farmerId:r,farmId:s,aeId:a,farmArea:i,farmBorders:c,sustainabilityIndex:l,additionalData:y}=t,O=[r,s,a,BigInt(i),c,BigInt(l),y],u=A.to(O),d=yield*x.promise(()=>e.wallet().signMessage(n,u));return{data:t,signedOracleMessage:d}}),Ie=(e,t)=>x.gen(function*(){let n=e.config().network,r=yield*x.promise(()=>e.wallet().address()),{paymentCredential:s}=E(r);if(!s)throw new Error("Payment credential is undefined");let a=j(t.scripts.syngentaOracleMinting,[s.hash]),i={type:"PlutusV3",script:a},c=P(i),l={type:"PlutusV3",script:a},y=R(n,l),{farmerId:O,farmId:u,aeId:d,farmArea:p,farmBorders:f,sustainabilityIndex:g,additionalData:S}=t.syngentaOracleData,C=[O,u,d,BigInt(p),f,BigInt(g),S],T={syngentaOracleMinting:i,syngentaOracleSpending:l},D=A.to(C),b=k(c,M(u)),N={[b]:1n};return{tx:yield*e.newTx().pay.ToContract(y,{kind:"inline",value:D},{[b]:1n}).mintAssets(N,A.void()).attach.MintingPolicy(i).addSignerKey(s.hash).completeProgram(),syngentaOraclePolicyId:c,scripts:T}}),Ce=(e,t)=>x.gen(function*(){let n=e.config().network,r=yield*x.promise(()=>e.wallet().address()),{paymentCredential:s}=E(r);if(!s)throw new Error("Payment credential is undefined");let a=P(t.scripts.syngentaOracleMinting),i=k(a,M(t.farmIdToUpdate)),c=t.scripts.syngentaOracleSpending,l=R(n,c),[y,...O]=yield*x.promise(()=>e.utxosAtWithUnit(l,i)),{farmerId:u,farmId:d,aeId:p,farmArea:f,farmBorders:g,sustainabilityIndex:S,additionalData:C}=t.newSyngentaOracleData,T=[u,d,p,BigInt(f),g,BigInt(S),C],D=A.to(T);return{tx:yield*e.newTx().collectFrom([y],A.void()).pay.ToContract(l,{kind:"inline",value:D},{[i]:1n}).addSignerKey(s.hash).attach.SpendingValidator(t.scripts.syngentaOracleSpending).completeProgram()}});import{Constr as I,Data as o}from"@lucid-evolution/lucid";var L=o.Object({txHash:o.Bytes({minLength:32,maxLength:32}),outputIndex:o.Integer()}),Me=L,h=o.Enum([o.Object({PublicKeyCredential:o.Tuple([o.Bytes()])}),o.Object({ScriptCredential:o.Tuple([o.Bytes()])})]),Ue=h,K=o.Object({paymentCredential:h,stakeCredential:o.Nullable(o.Enum([o.Object({Inline:o.Tuple([h])}),o.Object({Pointer:o.Tuple([o.Object({slotNumber:o.Integer(),transactionIndex:o.Integer(),certificateIndex:o.Integer()})])})]))}),Ve=K,F=o.Object({policyId:o.Bytes(),assetName:o.Bytes()}),ve=F,W=o.Map(o.Bytes(),o.Map(o.Bytes(),o.Integer())),_e=W,Y=o.Tuple([o.Bytes(),o.Bytes(),h,h]),He=Y,z=o.Object({directoryNodeCS:o.Bytes({minLength:28,maxLength:28}),progLogicCred:h},{hasConstr:!1}),Be=z,Ne=e=>e.type==="Key"?new I(0,[e.hash]):new I(1,[e.hash]),je=e=>new I(1,[e]),Le=e=>new I(0,[e]);import{fromText as $}from"@lucid-evolution/lucid";var G=36e5,q=315576e5,We=2*q,Ye=24*G,ze=.05,$e=process.env.NODE_ENV=="emulator"?0:1e5,Ge="014e9d57e1623f7eeef5d0a8d4e6734a562ba32cf910244cd74e1680",qe="5e8aa3f089868eaadf188426f49db6566624844b6c5d529b38f3b8a7",Je={policyId:"",assetName:""},Qe={spendSyngentaOracle:"PSpendSyngentaOracle",mintSyngentaOracle:"PMintSyngentaOracle"},Xe=$("SyngentaOracle");import{validatorToAddress as U}from"@lucid-evolution/lucid";var it=(e,t)=>{let n={type:"PlutusV3",script:t.minting},r=e.config().network,s=U(r,n),a={type:"PlutusV3",script:t.spending},i=U(r,a);return{spendValidator:a,spendValAddress:i,mintValidator:n,mintValAddress:s}};import{addAssets as J,applyDoubleCborEncoding as Q,Constr as m,credentialToAddress as X,Data as H,Emulator as Z,generateSeedPhrase as ee,getAddressDetails as B,keyHashToCredential as w,Lucid as te,scriptHashToCredential as V,validatorToAddress as v}from"@lucid-evolution/lucid";function St(e){return{type:"ok",data:e}}var ne=async(e,t,n)=>{let r=e.config().network,s={type:"PlutusV3",script:t},a=n?v(r,s,w(n)):v(r,s);return e.utxosAt(a)},re=(e,t)=>{if(e)try{return{type:"right",value:H.from(e,t)}}catch(n){return{type:"left",value:`invalid datum : ${n}`}}else return{type:"left",value:"missing datum"}},ht=async(e,t,n,r)=>{try{return(await ne(e,t,r)).flatMap(a=>{let i=re(a.datum,n);return i.type=="right"?{outRef:{txHash:a.txHash,outputIndex:a.outputIndex},datum:i.value,assets:a.assets}:[]})}catch{return[]}},At=e=>Q(e),It=async e=>{let t=ee(),n=await te(new Z([]),"Custom");n.selectWallet.fromSeed(t);let r=n.wallet().address;return{seedPhrase:t,address:r,assets:e}};function Ct(e){let{paymentCredential:t,stakeCredential:n}=B(e);if(!t)throw new Error("Not a valid payment address.");return{paymentCredential:t?.type==="Key"?{PublicKeyCredential:[t.hash]}:{ScriptCredential:[t.hash]},stakeCredential:n?{Inline:[n.type==="Key"?{PublicKeyCredential:[n.hash]}:{ScriptCredential:[n.hash]}]}:null}}function Tt(e,t){let n=(()=>"PublicKeyCredential"in e.paymentCredential?w(e.paymentCredential.PublicKeyCredential[0]):V(e.paymentCredential.ScriptCredential[0]))(),r=(()=>{if(e.stakeCredential&&"Inline"in e.stakeCredential)return"PublicKeyCredential"in e.stakeCredential.Inline[0]?w(e.stakeCredential.Inline[0].PublicKeyCredential[0]):V(e.stakeCredential.Inline[0].ScriptCredential[0])})();return X(t,n,r)}var Dt=e=>{let t=B(e);if(!t.paymentCredential)return{type:"error",error:new Error("undefined paymentCredential")};let n=t.paymentCredential.type=="Key"?new m(0,[t.paymentCredential.hash]):new m(1,[t.paymentCredential.hash]);if(!t.stakeCredential)return{type:"ok",data:new m(0,[n,new m(1,[])])};let r=new m(0,[new m(0,[new m(0,[t.stakeCredential.hash])])]);return{type:"ok",data:new m(0,[n,r])}},bt=(e,t)=>{let n=Math.ceil(e.length/t);return[...Array(n)].map((r,s)=>e.slice(s*t,(s+1)*t))},wt=(e,t)=>typeof t=="bigint"?t.toString():t,Et=(e,t)=>1n+(e-1n)/t;function Pt(e,t){let n=Object.entries(t),r={...e};return n.forEach(([s,a])=>{r[s]?r[s]+=a:r[s]=a}),r}function kt(e){let t=new Map;e.lovelace&&t.set("",new Map([["",e.lovelace]]));let n=Object.keys(e);return Array.from(new Set(n.filter(s=>s!=="lovelace").map(s=>s.slice(0,56)))).sort().forEach(s=>{let a=n.filter(c=>c.slice(0,56)===s),i=new Map;a.sort().forEach(c=>{i.set(c.slice(56),e[c])}),t.set(s,i)}),t}function Rt(e){let t={lovelace:e.get("")?.get("")||BigInt(0)};for(let[n,r]of e)if(n!=="")for(let[s,a]of r)t[n+s]=a;return t}function Mt(e,t){let n=[],r=!1,s=new Map(Object.entries(t));for(let a of e)if(!a.scriptRef){r=!1;for(let[i,c]of s)if(Object.hasOwn(a.assets,i)){let l=a.assets[i];l>=c?s.delete(i):s.set(i,c-l),r=!0}if(r&&n.push(a),s.size==0)break}return s.size>0?{type:"error",error:new Error("Insufficient funds")}:{type:"ok",data:n}}function Ut(e,t){let n=e.concat(t),r=se(n),s=new Map;return r.forEach((a,i)=>{s.set(a.txHash+a.outputIndex,BigInt(i))}),e.flatMap(a=>{let i=s.get(a.txHash+a.outputIndex);return i!==void 0?i:[]})}function se(e){return e.sort((t,n)=>t.txHash<n.txHash?-1:t.txHash>n.txHash?1:t.txHash==n.txHash?t.outputIndex<n.outputIndex?-1:1:0)}function Vt(e){return e.map(t=>t.assets).reduce((t,n)=>J(t,n),{})}function vt(e,t){return Object.fromEntries(Object.entries(e).filter(([n])=>n.startsWith(t)))}function _t(e,t){return Object.fromEntries(Object.entries(e).filter(([n])=>t.includes(n.slice(0,56))))}function Ht(e,t){for(let[n,r]of Object.entries(t))Object.hasOwn(e,n)&&(e[n]<r?delete e[n]:e[n]>r?e[n]-=r:delete e[n]);return e}var Bt=async(e,t)=>(await fetch(`/api/blockfrost/1/assets/${e}`,{headers:{project_id:t}}).then(r=>r.json())).onchain_metadata,Nt=async(e,t,n)=>(await e.utxosAt(t)).filter(s=>{let a=Object.keys(s.assets);return Array.from(new Set(a.filter(c=>c!=="lovelace").map(c=>c.slice(0,56)))).includes(n)}),_=e=>e.sort((t,n)=>t.txHash>n.txHash?1:t.txHash<n.txHash?-1:t.outputIndex>n.outputIndex?1:-1),jt=e=>{let t=e.concat(e.concat(e)).map(n=>new m(0,[n]));return console.log("Freeze Redeemer: ",t),H.to(t)},Lt=({referenceInputs:e,inputs:t,outputs:n,inputSelectionCriteria:r,refInputSelectionCriteria:s,outputSelectionCriteria:a,makeRedeemer:i})=>{let l=_(e).map(d=>[d,BigInt(e.findIndex(p=>d==p))]),y;if(r&&t){let p=_(t).map(g=>[g,BigInt(t.findIndex(S=>g==S))]),f=[];for(let[g,S]of p)r(g)&&f.push(BigInt(S));y=f.length>0?f:void 0}let O;if(a&&n){let d=[];for(let[p,f]of n.entries())a(f)&&d.push(BigInt(p));O=d.length>0?d:void 0}let u=[];for(let[d,p]of l)s(d)&&u.push(BigInt(p));return i(u,y,O)};export*from"@lucid-evolution/lucid";export{Je as ADA,Ve as AddressD,K as AddressSchema,ve as AssetClassD,F as AssetClassSchema,Ue as CredentialD,h as CredentialSchema,He as DirectoryNodeDatum,Y as DirectoryNodeDatumSchema,G as ONE_HOUR_MS,q as ONE_YEAR_MS,Me as OutputReference,L as OutputReferenceSchema,ze as PROTOCOL_FEE,Ge as PROTOCOL_PAYMENT_KEY,qe as PROTOCOL_STAKE_KEY,Be as ProtocolParametersDatum,z as ProtocolParametersDatumSchema,Qe as REF_SCRIPT_TOKEN_NAMES,Xe as SYNGENTA_ORACLE_TOKEN_NAME,$e as TIME_TOLERANCE_MS,Ye as TWENTY_FOUR_HOURS_MS,We as TWO_YEARS_MS,_e as Value,W as ValueSchema,bt as chunkArray,Ie as deploySyngentaOracle,Et as divCeil,_t as filterForeignPoliciesFromAssets,vt as filterPolicyFromAssets,Ct as fromAddress,Dt as fromAddressToData,kt as fromAssets,It as generateAccountSeedPhrase,Ut as getInputUtxoIndices,it as getMultiValidator,Ae as getSignedOracleMessage,Le as keyHashToCredentialData,jt as makeFreezeRedeemer,Lt as makeTransferRedeemer,Bt as mintingMetadataFromAsset,St as ok,re as parseSafeDatum,ht as parseUTxOsAtScript,Ht as removeAssets,wt as replacer,je as scriptHashToCredentialData,Mt as selectUtxos,se as sortByOutRefWithIndex,_ as sortUtxosByOutRef,Vt as sumUtxoAssets,Tt as toAddress,Rt as toAssets,At as toCBORHex,Ne as toCredentialData,Pt as union,Ce as updateSyngentaOracle,Nt as utxosAtAddressWithPolicyId,ne as utxosAtScript};
